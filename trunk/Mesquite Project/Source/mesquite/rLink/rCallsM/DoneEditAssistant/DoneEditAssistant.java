/* Mesquite source code.  Copyright 1997-2009 W. Maddison and D. Maddison.Version 2.6, January 2009.Disclaimer:  The Mesquite source code is lengthy and we are few.  There are no doubt inefficiencies and goofs in this code. The commenting leaves much to be desired. Please approach this source code with the spirit of helping out.Perhaps with your help we can be more than a few, and make Mesquite better.Mesquite is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.Mesquite's web site is http://mesquiteproject.orgThis source code and its compiled class files are free and modifiable under the terms of GNU Lesser General Public License.  (http://www.gnu.org/copyleft/lesser.html)*/package mesquite.rLink.rCallsM.DoneEditAssistant;import java.awt.*;import java.util.*;import mesquite.lib.*;import mesquite.lib.duties.*;/* ======================================================================== */public class DoneEditAssistant extends TreeDisplayAssistantD  {	Vector notes;	boolean done = false;	/*.................................................................................................................*/	 public String getName() {	return "Done Edit Assistant";	 }/*.................................................................................................................*/	 public String getExplanation() {	return "Manages Done button for R tree edting.";	 }	 		/*.................................................................................................................*/	public boolean startJob(String arguments, Object condition, boolean hiredByName) {		notes = new Vector();    	 	return true; 	}	public boolean isDone(){		return done;	}	/*.................................................................................................................*/	public   TreeDisplayExtra createTreeDisplayExtra(TreeDisplay treeDisplay) {		DoneEditOperator newNote = new DoneEditOperator(this, treeDisplay);		done = false;		notes.addElement(newNote);		return newNote;	}	/*.................................................................................................................*/	/** returns whether this module is requesting to appear as a primary choice */   	public boolean requestPrimaryChoice(){   		return true;     	}	/*.................................................................................................................*/   	public boolean isSubstantive(){   		return false;     	}	/*.................................................................................................................*/  	 public Snapshot getSnapshot(MesquiteFile file) {   	 	Snapshot temp = new Snapshot();  	 	if (notes.size()>0){	  	 	DoneEditOperator tno = (DoneEditOperator)notes.elementAt(0);	  	 	DoneEditButton tn = tno.getNote();	  	 	temp.addLine("getNote");	  	 	temp.addLine("tell It");	  	 	temp.incorporate(tn.getSnapshot(file), true);	  	 	temp.addLine("endTell");					}  	 	return temp;  	 }	/*.................................................................................................................*/    	 public Object doCommand(String commandName, String arguments, CommandChecker checker) {    	 	if (checker.compare(this.getClass(), "Turns off this note", null, commandName, "closeNote")) {    	 		closeAllNotes();    	 		iQuit();    	 	}    	 	else if (checker.compare(this.getClass(), "Returns the note object", null, commandName, "getNote")) {  	 		if (notes.size()>0){		  	 	DoneEditOperator tno = (DoneEditOperator)notes.elementAt(0);		  	 	return tno.getNote();  	 		}    	 	}    	 	else if (checker.compare(this.getClass(), "Sets the font", null, commandName, "setFont")) {			Enumeration e = notes.elements();			while (e.hasMoreElements()) {				Object obj = e.nextElement();				if (obj instanceof DoneEditOperator) {					DoneEditOperator tCO = (DoneEditOperator)obj;		 			tCO.editButton.doCommand("setFont", arguments, checker);		 		}			}    	 	}    	 	else if (checker.compare(this.getClass(), "Sets the font size", null, commandName, "setFontSize")) {			Enumeration e = notes.elements();			while (e.hasMoreElements()) {				Object obj = e.nextElement();				if (obj instanceof DoneEditOperator) {					DoneEditOperator tCO = (DoneEditOperator)obj;		 			tCO.editButton.doCommand("setFontSize", arguments, checker);		 		}			}    	 	}    	 	else    	 		return  super.doCommand(commandName, arguments, checker);		return null;   	 }   		/*.................................................................................................................*/ 	public void closeAllNotes() {		Enumeration e = notes.elements();		while (e.hasMoreElements()) {			Object obj = e.nextElement();			if (obj instanceof DoneEditOperator) {				DoneEditOperator tCO = (DoneEditOperator)obj;	 			tCO.turnOff();	 		}		}	}	/*.................................................................................................................*/ 	public void endJob() {    	 	closeAllNotes(); 		super.endJob();		resetContainingMenuBar(); 	}}/* ======================================================================== */class DoneEditOperator extends TreeDisplayDrawnExtra {	DoneEditAssistant notesModule;	DoneEditButton editButton;			public DoneEditOperator (DoneEditAssistant ownerModule, TreeDisplay treeDisplay) {		super(ownerModule, treeDisplay);		this.notesModule=ownerModule;		editButton = new DoneEditButton(notesModule, this);		editButton.setVisible(false);		addPanelPlease(editButton);	}	public DoneEditButton getNote(){		return editButton;	}	/*.................................................................................................................*/	public   void placeNote(Tree tree, int drawnRoot) {		int noteX = treeDisplay.getTreeDrawing().x[drawnRoot]+editButton.getOffsetX();		int noteY = treeDisplay.getTreeDrawing().y[drawnRoot]+editButton.getOffsetY();				if (noteX>treeDisplay.getBounds().width) {			editButton.setOffsetX(treeDisplay.getBounds().width-treeDisplay.getTreeDrawing().x[drawnRoot]-40);			noteX = treeDisplay.getTreeDrawing().x[drawnRoot]+editButton.getOffsetX();		}		else if (noteX<0) {			editButton.setOffsetX(-treeDisplay.getTreeDrawing().x[drawnRoot]+4);			noteX = treeDisplay.getTreeDrawing().x[drawnRoot]+editButton.getOffsetX();		}					if (noteY>treeDisplay.getBounds().height) {			editButton.setOffsetY(treeDisplay.getBounds().height-treeDisplay.getTreeDrawing().y[drawnRoot]-40);			noteY = treeDisplay.getTreeDrawing().y[drawnRoot]+editButton.getOffsetY();		}		else if (noteY<0) {			editButton.setOffsetY(-treeDisplay.getTreeDrawing().y[drawnRoot]+4);			noteY = treeDisplay.getTreeDrawing().y[drawnRoot]+editButton.getOffsetY();		}		if ((noteX!=editButton.getBounds().x) || (noteY!=editButton.getBounds().y))			editButton.setLocation(noteX, noteY);					if (!editButton.isVisible()) {			editButton.setVisible(true);		}	}	/*.................................................................................................................*/	public   void setTree(Tree tree) {	}	/*.................................................................................................................*/	public   void drawOnTree(Tree tree, int drawnRoot, Graphics g) {		if (!editButton.isVisible()) {			editButton.setVisible(true);		}		//placeNote(tree, drawnRoot);	}	/*.................................................................................................................*/	public   void printOnTree(Tree tree, int drawnRoot, Graphics g) {		if (!editButton.isVisible()) {			editButton.setVisible(true);		}		//placeNote(tree, drawnRoot);		//treeNote.print(g);	}		/*.................................................................................................................*/	public void turnOff() {		if (editButton!=null && treeDisplay!=null)			removePanelPlease(editButton);		super.turnOff();	}}/* ======================================================================== */class DoneEditButton extends Legend {	DoneEditAssistant ownerModule;	DoneEditOperator notesOperator;	int noteWidth=100;	int noteHeight=120;	int topEdge = 6;	int cornerEdge = 4;	boolean invalid;		boolean checkHeight = true;	Font font=null;		public DoneEditButton(DoneEditAssistant ownerModule, DoneEditOperator notesOperator) {		super(100, 20);		this.ownerModule = ownerModule;		this.notesOperator = notesOperator;		//setBackground(getParent().getBackground());		setLayout(null);		font = getFont();		checkHeight = true;		setBackground(Color.yellow);		setSize(noteWidth, noteHeight);	}		public void invalidate(){		invalid = true;	}			public void resetHeight(int height) {		noteHeight = height;		super.setSize(noteWidth, height);	}		public void paint(Graphics g) {	   	if (MesquiteWindow.checkDoomed(this))	   		return;		invalid = false;		if (g instanceof PrintGraphics) {		}		else {			if (font==null) {				font = getFont();			}			g.setColor(Color.cyan);			g.setClip(0,0,noteWidth, topEdge);			g.fillRoundRect(0, 0, noteWidth-1, noteHeight, 8, 8);			g.setColor(Color.blue);			g.drawRoundRect(0, 0, noteWidth-1, noteHeight, 8, 8);			g.setClip(0,0,noteWidth, noteHeight);			g.drawLine(0, topEdge, noteWidth-1, topEdge);			g.setColor(Color.cyan);			g.drawRect(0, topEdge, noteWidth-1, noteHeight-1-topEdge);			g.fillRect(noteWidth - 8, noteHeight - cornerEdge, 8, cornerEdge);			g.fillRect(noteWidth - cornerEdge, noteHeight - 8, cornerEdge, 8);			g.setColor(Color.black);						if (invalid)				repaint();		}		MesquiteWindow.uncheckDoomed(this);	}	public void mouseDown (int modifiers, int clickCount, long when, int x, int y, MesquiteTool tool) {		if (y<=topEdge) {			if (x>= noteWidth - 16) {				if (MesquiteEvent.controlKeyDown(modifiers))						panelTouched(modifiers, x,y, false);				else					ownerModule.showPopUp(this, x+8, y+8);			}			else {				super.mouseDown(modifiers, clickCount, when, x, y, tool);			}		}		else {			ownerModule.done = true;		}	}}