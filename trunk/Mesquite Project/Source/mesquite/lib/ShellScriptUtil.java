/* Mesquite source code.  Copyright 1997-2006 W. Maddison and D. Maddison.Version 1.11, June 2006.Disclaimer:  The Mesquite source code is lengthy and we are few.  There are no doubt inefficiencies and goofs in this code. The commenting leaves much to be desired. Please approach this source code with the spirit of helping out.Perhaps with your help we can be more than a few, and make Mesquite better.Mesquite is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.Mesquite's web site is http://mesquiteproject.orgThis source code and its compiled class files are free and modifiable under the terms of GNU Lesser General Public License.  (http://www.gnu.org/copyleft/lesser.html)*/package mesquite.lib;import java.awt.*;import java.util.*;import java.io.*;import mesquite.lib.duties.*;/* ======================================================================== */public class ShellScriptUtil  {	    	/*.................................................................................................................*/    	public static String getWriteStringAsFile(String path, String contents) {    		if (MesquiteTrunk.isWindows())    			return "echo \"" + contents + "\" > " + StringUtil.protectForWindows(path) + StringUtil.lineEnding();    		else    			return "echo \"" + contents + "\" > " + StringUtil.protectForUnix(path) + StringUtil.lineEnding();    	}    	    	/*.................................................................................................................*    	String getAliasCommand(String alias, String expansion){    		return "alias " +StringUtil.protectForUnix(alias) + " " + StringUtil.protectForUnix(expansion) +StringUtil.lineEnding();    	}    	/*.................................................................................................................*/    	public static String getLinkCommand(String path, String aliasPath){    		if (MesquiteTrunk.isWindows())    			return "shortcut -f -t " +StringUtil.protectForWindows(path) + " -n " + StringUtil.protectForUnix(aliasPath) +StringUtil.lineEnding();    		else    			return "ln  " +StringUtil.protectForUnix(path) + " " + StringUtil.protectForUnix(aliasPath) +StringUtil.lineEnding();    	}    	/*.................................................................................................................*/    	public static String getChangeDirectoryCommand(String directory){    		String directoryString;    		if (MesquiteTrunk.isWindows()) {    			directoryString = StringUtil.protectForWindows(directory);    		} else {    			directoryString = StringUtil.protectForUnix(directory);    		}    		return "cd " + directoryString +StringUtil.lineEnding();    	}    	/*.................................................................................................................*/    	public static String getRemoveCommand(String filePath){    		if (MesquiteTrunk.isWindows())    			return "del -f " + StringUtil.protectForWindows(filePath) +StringUtil.lineEnding();    		else    			return "rm -f " + StringUtil.protectForUnix(filePath) +StringUtil.lineEnding();    	}    	/*.................................................................................................................*/    	public static String getSetFileTypeCommand(String filePath){    		if (MesquiteTrunk.isMacOSX())    			return "/Developer/Tools/setFile -t TEXT " + StringUtil.protectForUnix(filePath) +StringUtil.lineEnding();    		else    			return "";    	}    	/*.................................................................................................................*/    	public static String getOpenDirectoryCommand(String directoryPath){    		if (MesquiteTrunk.isMacOSX())    			return "open " + StringUtil.protectForUnix(directoryPath) +StringUtil.lineEnding();    		else    			return "";    	}    /*.................................................................................................................*/    	public static Process executeScript(String scriptPath){ 	    		  Process proc;    		  try {    		    if (MesquiteTrunk.isMacOSX())    		      proc = Runtime.getRuntime().exec(new String[] {"open", "-a","/Applications/Utilities/Terminal.app", scriptPath} );    		    else if (MesquiteTrunk.isLinux()) {    		    	// remove double slashes or things won't execute properly    		    	scriptPath = scriptPath.replaceAll("//", "/");    		    	proc = Runtime.getRuntime().exec(new String[] {scriptPath} );    		    } else {    		    	scriptPath = "\"" + scriptPath + "\"";    		    	String[] cmd = {"cmd", "/c", scriptPath};    		    	proc = Runtime.getRuntime().exec(cmd);    		    }    		  }  catch (IOException e) {    		    MesquiteMessage.println("Script execution failed.");    		    return null;    		  }    		  if (proc != null) {    			  StreamGobbler errorGobbler = new StreamGobbler(proc.getErrorStream(), "ERROR");    			  StreamGobbler outputGobbler = new StreamGobbler(proc.getInputStream(), "OUTPUT");    			  errorGobbler.start();    			  outputGobbler.start();    		  }    		  return proc;    		}    	/*.................................................................................................................*/    	public static boolean setScriptFileToBeExecutable(String scriptPath) throws IOException {    		Process proc;    		try {    			if (!MesquiteTrunk.isWindows())    				Runtime.getRuntime().exec(new String[] {"chmod", "+x", scriptPath } );    		}		catch (IOException e) {			MesquiteMessage.println("Script cannot be set to be executable.");			return false;		}		return true;    	}}class StreamGobbler extends Thread {	InputStream is;	String type;	StreamGobbler(InputStream is, String type) {		this.is = is;		this.type = type;	}	public void run() {		try {			InputStreamReader isr = new InputStreamReader(is);			BufferedReader br = new BufferedReader(isr);			String line = null;			while ((line = br.readLine()) != null) {			}		} catch (IOException ioe) {			ioe.printStackTrace();		}	}}